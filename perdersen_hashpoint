##*************************************************************************************/
##/* Copyright (C) 2022 - Renaud Dubois - This file is part of cy_lib project	 */
##/* License: This software is licensed under a dual BSD and GPL v2 license. 	 */
##/* See LICENSE file at the root folder of the project.				 */
##/* FILE: musig2.sage							         */
##/* 											 */
##/* 											 */
##/* DESCRIPTION: Pedersen Hash modified Stark version as coded in */
##/* https://github.com/starkware-libs/cairo-lang/blob/master/src/starkware/crypto/signature/fast_pedersen_hash.py
##/source code 		 */
##/**************************************************************************************/

PEDERSEN_SHIFT = 
[##shift = constant[0]
   0x49ee3eba8c1600700ee1b87eb599f16716b0b1022947733551fde4050ca6804,
   0x3ca0cfe4b3bc6ddf346d49d06ea0ed34e621062c0e056c1d0405d266e10268a	
];

PEDERSEN_POINTS[
        [##P0 = constant[2]
            0x234287dcbaffe7f969c748655fca9e58fa8120b6d56eb0c1080d17957ebe47b,
            0x3b056f100f96fb21e889527d41f4e39940135dd7a6c94cc6ed0268ee89e5615
        ],
        [##P1
            0x04fa56f376c83db33f9dab2656558f3399099ec1de5e3018b7a6932dba8aa378,
            0x03fa0984c931c9e38113e0c0e47e4401562761f92a7a23b45168f4e80ff5b54d
        ],
       ,
        [##P2
          0x04ba4cc166be8dec764910f75b45f74b40c690c74709e90f3aa372f0bd2d6997,        
          0x0040301cf5c1751f4b971e46c4ede85fcac5c59a5ce5ae7c48151f27b24b219c
        ],
        [##P3
          0x054302dcb0e6cc1c6e44cca8f61a63bb2ca65048d53fb325d36ff12c49a58202,
          0x01b77b3e37d13504b348046268d8ae25ce98ad783c25561a879dcc77e99c2426
        ]
    ];
    
def  pedersen(a,b):
	hi_a=a>>248;
	low_a =a&(2^248-1);
	hi_b=b>>248;
	low_b =b&(2^248-1);
	HashPoint=PEDERSEN_SHIFT+low_a*P0+hi_a*P1+low_b*P2+hi_b*P3;
	
	return HashPoint[0];
	
	
	
